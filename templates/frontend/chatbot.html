{% load static%}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Chat Interface | Finlytic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .chat-input {
            padding: 15px;
            background-color: #f8f9fa;
        }
        .contact-list {
            height: 100vh;
            overflow-y: auto;
        }
        #messageForm {
            display: flex;
            width: 100%;
        }
        #message-input {
            flex-grow: 1;
        }
        #send-button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <div class="col-md-4 col-lg-3 p-0 bg-light">
                <div class="contact-list p-3">
                    <div class="input-group mb-3">
                        <a href="{% url 'dashboard:dashboard' %}" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="{% static 'frontend/assets/images/logo/logo-transp.png'  %}" alt="logo-sm-light" height="60">
                            </span>
                        </a>
                    </div>
                    <br>
                    <ul class="list-unstyled">
                        <h1>Summary</h1>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officiis, quibusdam recusandae quas ab dolore voluptatibus nemo veniam quidem mollitia doloremque deleniti minus neque, consectetur sapiente cum fugiat? Asperiores, quasi blanditiis.</p>
                    </ul>
                </div>
            </div>
            <div class="col-md-8 col-lg-9 p-0">
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- Chat messages will be dynamically added here -->
                    </div>
                    <div class="chat-input">
                        <form id="messageForm" action="{% url 'frontend:chatbot' %}" method="post">
                            {% csrf_token %}
                            <input type="text" class="form-control" placeholder="Type a message" id="message-input">
                            <button class="btn btn-primary" type="submit" id="send-button"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#messageForm').on('submit', function(event) {
                event.preventDefault();
                
                var form = $(this);
                var formData = form.serialize();
                var url = form.attr('action');
                var method = form.attr('method').toUpperCase(); // Ensure method is uppercase
                
                // Only proceed if the method is POST
                if (method === 'POST') {
                    $.ajax({
                        type: method,
                        url: url,
                        data: formData,
                        dataType: 'json',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                        },
                        success: function(response) {
                            form[0].reset();
                            console.log('Input successfully posted to the database.');
    
                            // Simulate response generation
                            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                            addMessage(randomResponse, false); // Display the random response
                        },
                        error: function(xhr, status, error) {
                            console.error('An error occurred while posting the data:', error);
                        }
                    });
                } else {
                    console.log('Only POST requests are allowed.');
                }
            });
        });
    
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
    
            const responses = [
                "It's essential for small and mid-scale businesses in Nepal to maintain accurate records of all income and expenses to comply with the Inland Revenue Department's regulations.",
                "Ensure you file your tax returns on time to avoid penalties and interest charges. In Nepal, the deadline for income tax returns is usually the end of Shrawan.",
                "Keeping receipts for business expenses can greatly help you during tax season. Make sure to organize them properly for easy reference.",
                "Consider taking advantage of available deductions. Business-related expenses such as rent, utilities, and employee salaries can often reduce your taxable income.",
                "Be aware of tax credits available for small businesses in Nepal, such as those for investments in certain sectors or regions.",
                "If you operate a home-based business, document any home office expenses; you might be eligible for deductions that can lower your taxable income.",
                "If you're self-employed or have income not subject to withholding, remember to make estimated tax payments quarterly to avoid penalties.",
                "To avoid compliance issues, ensure you are paying enough in estimated taxes throughout the fiscal year. Regularly review your financials.",
                "Donâ€™t forget to consider local taxes, as compliance requirements can vary significantly by municipality in Nepal.",
                "If you operate in multiple regions, you might need to comply with local tax regulations in each area. Always check local laws.",
                "Maintain organized records for at least five years, which is typically the period the tax authorities can audit your tax return in Nepal.",
                "Using accounting software tailored for Nepalese businesses can simplify tax preparation and help you keep organized records.",
                "Your choice of business structure (e.g., sole proprietorship, partnership, private limited company) can impact your tax obligations. Choose one that aligns with your growth plans.",
                "Consider consulting with a local tax advisor who understands the nuances of Nepal's tax system to help you navigate your tax obligations effectively.",
                "Stay updated on any changes in tax laws that may affect your business. Engage with local business associations to receive relevant updates.",
                "Selecting the correct filing status is crucial. Understand the implications of being a sole proprietor versus operating as a private limited company.",
                "If selected for an audit, stay calm and prepare by gathering all relevant documentation to support your claims to the tax authorities.",
                "Responding promptly to any inquiries from the Inland Revenue Department can help resolve issues more efficiently and avoid penalties.",
                "If your tax situation is complex, especially with VAT and service tax regulations, consider hiring a certified tax professional for personalized guidance.",
                "Using mobile accounting applications can help you keep track of your finances on the go, which is especially useful for small business owners."
            ];
    
            function addMessage(content, isUser = true) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('d-flex', 'mb-4', isUser ? 'justify-content-end' : 'justify-content-start');
                
                const messageBubble = document.createElement('div');
                messageBubble.classList.add('p-3', 'rounded', isUser ? 'bg-primary' : 'bg-light');
                messageBubble.style.maxWidth = '70%';
                messageBubble.textContent = content;
    
                messageDiv.appendChild(messageBubble);
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
    
            sendButton.addEventListener('click', function() {
                const message = messageInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    messageInput.value = '';
    
                    // Generate a random response from the responses array
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    setTimeout(() => addMessage(randomResponse, false), 1000); // Simulate response delay
                }
            });
    
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendButton.click();
                }
            });
    
            // Initial greeting message
            addMessage("Hello! How can I help you today?", false);
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');

            function addMessage(content, isUser = true) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('d-flex', 'mb-4', isUser ? 'justify-content-end' : 'justify-content-start');
                
                const messageBubble = document.createElement('div');
                messageBubble.classList.add('p-3', 'rounded', isUser ? 'bg-primary' : 'bg-light');
                messageBubble.style.maxWidth = '70%';
                messageBubble.textContent = content;

                messageDiv.appendChild(messageBubble);
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            sendButton.addEventListener('click', function() {
                const message = messageInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    messageInput.value = '';
                    // Simulate a response (you would replace this with actual server communication)
                    setTimeout(() => addMessage("This is a simulated response.", false), 1000);
                }
            });

            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendButton.click();
                }
            });

            addMessage("Hello! How can I help you today?", false);
        });
    </script>
</body>
</html>